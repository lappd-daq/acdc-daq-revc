cmake_minimum_required(VERSION 3.1)
project(acdc-daq-revc)
set(acdc-daq-revc_VERSION_MAJOR 1)
set(acdc-daq-revc VERSION_MINOR 1)

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++14")
set(CMAKE_BINARY_DIR ${CMAKE_SOURCE_DIR}/bin)
set(EXECUTABLE_OUTPUT_PATH ${CMAKE_BINARY_DIR})
set(LIBRARY_OUTPUT_PATH ${CMAKE_BINARY_DIR})
set(LIBRARY_SOURCE_DIR "${CMAKE_SOURCE_DIR}/lib")
set(EXECUTABLE_SOURCE_DIR "${CMAKE_SOURCE_DIR}/src")

include(ExternalProject)
ExternalProject_Add(project_yaml_cpp
        GIT_REPOSITORY "https://github.com/jbeder/yaml-cpp"
        GIT_TAG "yaml-cpp-0.6.3"
        INSTALL_COMMAND ""
        PREFIX ${CMAKE_CURRENT_BINARY_DIR}/yaml-cpp)
ExternalProject_Get_Property(project_yaml_cpp source_dir)
ExternalProject_Get_Property(project_yaml_cpp binary_dir)

add_library(yaml-cpp SHARED IMPORTED)
add_dependencies(yaml-cpp project_yaml_cpp)
set_property(TARGET yaml-cpp PROPERTY IMPORTED_LOCATION ${binary_dir}/libyaml-cpp.a)


include_directories(${CMAKE_SOURCE_DIR}/include)
include_directories(${source_dir}/include)
include_directories(${source_dir}/local/include)


add_compile_options(-g -Wall -Wextra -Wpedantic -fstack-protector)

add_library(ACC
        ${LIBRARY_SOURCE_DIR}/ACC.cpp)

add_library(ACDC
        ${LIBRARY_SOURCE_DIR}/ACDC.cpp)

add_library(myusb
        ${LIBRARY_SOURCE_DIR}/stdUSB.cpp)

add_library(Metadata
        ${LIBRARY_SOURCE_DIR}/Metadata.cpp)

add_library(Config
        ${LIBRARY_SOURCE_DIR}/Config.cpp)

target_link_libraries(ACC myusb ACDC)
target_link_libraries(ACDC Metadata)
target_link_libraries(Config ACC myusb yaml-cpp)
target_link_libraries(myusb PUBLIC usb-1.0)




add_executable(readACDC ${EXECUTABLE_SOURCE_DIR}/readACDC.cpp)
add_executable(setConfig ${EXECUTABLE_SOURCE_DIR}/setConfig.cpp)
add_executable(printAcdcMetadata ${EXECUTABLE_SOURCE_DIR}/printAcdcMetadata.cpp)
add_executable(logData ${EXECUTABLE_SOURCE_DIR}/logData.cpp)
add_executable(calibratePed ${EXECUTABLE_SOURCE_DIR}/calibratePed.cpp)
add_executable(calEnable ${EXECUTABLE_SOURCE_DIR}/calEnable.cpp)
add_executable(reset ${EXECUTABLE_SOURCE_DIR}/reset.cpp)
add_executable(alignLVDS ${EXECUTABLE_SOURCE_DIR}/alignLVDS.cpp)
add_executable(testFunction ${EXECUTABLE_SOURCE_DIR}/testFunction.cpp)
add_executable(debug ${EXECUTABLE_SOURCE_DIR}/debug.cpp)






target_link_libraries(readACDC PUBLIC ACC)
target_link_libraries(logData PUBLIC ACC)
target_link_libraries(setConfig PUBLIC ACC Config)
target_link_libraries(printAcdcMetadata PUBLIC ACC)
target_link_libraries(calibratePed PUBLIC ACC)
target_link_libraries(calEnable PUBLIC ACC)
target_link_libraries(reset PUBLIC ACC)
target_link_libraries(alignLVDS PUBLIC ACC)
target_link_libraries(testFunction PUBLIC ACC)
target_link_libraries(debug PUBLIC myusb)




